#include <AccelStepper.h>
#include <ezButton.h>


// STEP/DIR pins for each stepper
#define stepPin1 2 //LA_y
#define dirPin1 3

// Limit switches
ezButton limitSwitch1(22); // LA_y min

// Stepper objects
AccelStepper stepper1(AccelStepper::DRIVER, stepPin1, dirPin1);
bool homingDone = false;
bool homingStarted=false;
// Position limits

void setup() {
  Serial.begin(9600);
  Serial.setTimeout(100);
  // Initialize limit switch debounce
  limitSwitch1.setDebounceTime(50);
  // Configure steppers
  stepper1.setMaxSpeed(200); 
  // declare dicrection
  stepper1.setPinsInverted(true, false);  
}

void loop() {
  if (!homingDone) {
    if (!homingStarted) {
      Serial.println("Starting homing...");
      stepper1.moveTo(-10000);
      homingStarted = true;
    }

    limitSwitch1.loop();
    stepper1.run();  // <-- keep it moving!

    if (limitSwitch1.isPressed()) {
      stepper1.stop();
      while (stepper1.isRunning()) {
        stepper1.run();  // make sure it fully stops
      }
      stepper1.setCurrentPosition(0);  // reset position to zero
      Serial.println("Motor 1 homed.");
      homingDone = true;
    }
  }
}
